# Проект: Классификация изображений и анализ изменений ландшафта

## Описание проекта

Этот проект включает в себя обработку изображений, построение и обучение сверточной нейронной сети (ConvNet) с использованием EfficientNetB7 в качестве основы, а также визуальный анализ изменений ландшафта с использованием компьютерного зрения. Ключевая цель — классификация изображений на различные классы и последующий анализ структурных изменений между изображениями.

---

## Этапы работы

### 1. Обработка данных

#### Загрузка данных:
- Данные загружаются в формате TFRecord.
- Используются функции для парсинга и чтения данных, которые возвращают пары (изображение, метка).

#### Аугментация данных:
Используются следующие методы аугментации:
- Случайное зеркальное отображение (`tf.image.random_flip_left_right`).
- Изменение насыщенности, контраста и яркости.

#### Разделение данных:
- Данные разбиваются на обучающую (80%) и валидационную (20%) выборки.
- Используется функция `shuffle` для перемешивания данных с фиксированным случайным состоянием (seed).

#### Подготовка батчей:
- Используется `repeat` для многократного повторения тренировочного набора.
- `batch` — для создания батчей фиксированного размера.
- `prefetch` — для оптимизации загрузки данных.

***

### 2. Построение модели

#### EfficientNetB7:
- Предобученная модель EfficientNetB7 используется как базовая архитектура для извлечения признаков.
- Верхние слои ("head") заменены:
  - Глобальный пуллинг (`GlobalAveragePooling2D`).
  - Полносвязный слой с 32 нейронами и активацией ReLU.
  - Выходной слой с функцией активации Softmax для классификации.

#### Компиляция модели:
- Оптимизатор: Adam.
- Функция потерь: `sparse_categorical_crossentropy`.
- Метрика: `sparse_categorical_accuracy`.

#### Обучение модели:
- Определен график изменения скорости обучения (learning rate schedule):
  - Линейное увеличение на первых этапах.
  - Постоянное значение на промежуточных этапах.
  - Экспоненциальное уменьшение на финальных этапах.
- Используется `LearningRateScheduler` для динамического управления скоростью обучения.
- Модель обучается с использованием функции `fit`, где указываются:
  - Обучающие и валидационные данные.
  - Количество эпох.
  - Число шагов на эпоху.

***

### 3. Оценка модели

#### Графики:
- Построены кривые:
  - Потерь на обучающей и валидационной выборках.
  - Точности на обучающей и валидационной выборках.

#### Матрица путаницы:
- Используется для анализа ошибок классификации.
- Нормализована построчно для интерпретации.
- Выявлено:
  - Путаница между классами PASTURES и FOREST.
  - Ошибки классификации RESIDENTIAL и INDUSTRIAL.

#### Метрики:
- Вычислены:
  - F1-score.
  - Precision (точность).
  - Recall (полнота).

***

### 4. Анализ изменений ландшафта

#### Сравнение изображений:
1. **Индекс структурного сходства (SSIM):**
   - Используется для оценки схожести двух изображений.
   - Если индекс < 0.99, рекомендуется обратить внимание на изменения в ландшафте.

2. **Разница между изображениями:**
   - Вычисляется разница пикселей между двумя изображениями.
   - Используется пороговая обработка для выделения изменений.
   - Создаются изображения, где изменения выделены красным цветом.

#### Визуализация:
- Построены графики, демонстрирующие:
  - Оригинальные изображения.
  - Разницу между изображениями.
  - Измененные области, наложенные на оригинальные изображения.

***

## Результаты

- **Качество модели:**
  - Точность модели достигла 0.69 (после оптимизации гиперпараметров).
  - F1-score, Precision и Recall предоставляют детальную оценку производительности.

- **Анализ изменений:**
  - Обнаружены значимые изменения в изображениях с использованием SSIM и визуальной разницы.

---

## Используемые библиотеки
- TensorFlow/Keras для создания и обучения модели.
- OpenCV для анализа изображений.
- Matplotlib для визуализации.
- NumPy для работы с массивами.

---

## Как запустить проект

1. Установите зависимости:
   ```bash
   pip install tensorflow opencv-python matplotlib numpy
   ```

2. Запустите обучение модели:
   - Следуйте описанным шагам для подготовки данных и тренировки модели.

3. Проведите визуальный анализ:
   - Сравните изображения с использованием предоставленного кода.

---

## Заключение

Проект демонстрирует успешное использование современных подходов к классификации изображений и анализу изменений. EfficientNetB7 позволил добиться хорошего качества классификации, а использование OpenCV обеспечило визуальный анализ изменений, полезный для задач мониторинга ландшафта.

